
<div class="page-header">
  <h1><%= t '.title' %></h1>
</div>

<table class="matches-table table">
  <thead>
    <tr>
      <th><%= t '.place' %></th>
      <th><%= t '.home' %></th>
      <th><%= t '.away' %></th>
      <th><%= t '.score' %></th>
      <th><%= t '.points' %></th>
      <th><%= t '.appointment' %></th>
      <th><%= t '.actions', default: t('helpers.actions') %></th>
    </tr>
  </thead>
  <tbody>
    <% last_gameday = nil %>
    <% @matches.each do |match| %>
      <% if match.gameday != last_gameday %>
        <tr class="gameday">
          <th colspan="7">
            <b>
              <%= t '.gameday' %> <%= match.gameday %>
            </b>
          </th>
        </tr>
        <% last_gameday = match.gameday %>
      <% end %>
      <tr>
        <td><%= match.place %></td>
        <td><%= match.team_home ? link_to(match.team_home.name, team_path(match.team_home)) : '---' %></td>
        <td><%= match.team_away ? link_to(match.team_away.name, team_path(match.team_away)) : '---' %></td>
        <td>
          <%= match.score_home ? match.score_home : '-' %>
          :
          <%= match.score_away ? match.score_away : '-' %>
        </td>
        <td>
          <%= form_for match, url: update_points_match_path(match), html: {method: "put"} do |f| %>
              <%= f.text_field :points_away, class: 'input-sm', style: 'width: 50px' %>
              :
              <%= f.text_field :points_home, class: 'input-sm', style: 'width: 50px' %>
              <%= f.submit t('helpers.links.save'), :class => 'btn btn-default btn-xs' %>
          <% end %>
        </td>
        <td>
          <!-- 32400 seconds so it is 09:00 as default time, otherwise it would be 00:00 -->
          <%= date = (match.start_time_date+match.gameday).strftime("%d-%m-%Y") %>
          <%= time = (match.start_time_time+32400).strftime("%H:%M") %>
          <button type="button" class="btn btn-info btn-xs" data-toggle="modal" data-target="#myModal">
            <%= t 'events.schedule.propose_new_appointment' %>
          </button>
          <!-- Modal -->
          <div id="myModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title">
                    <%= t 'events.schedule.propose_new_appointment' %>
                  </h4>
                </div>
                <%= form_for match, url: update_start_time_match_path(match), html: {method: "put"} do |f| %>
                  <div class="modal-body">
                  <p>
                    <%= t '.appointment' %>
                  </p>
                  <%= f.text_field :start_time, :class => 'form-control', :value => date, :data => { :provide => 'datepicker', "date-format" => "yyyy-mm-dd" } %>
                  <p>
                    <%= t '.time'%>
                  </p>

                  <div class="input-group bootstrap-timepicker timepicker">
                    <%= f.text_field :start_time, :class => 'form-control', :value => time, :data => { :provide => 'timepicker' }, :id => "time" %>
                    <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
                  </div>

                  <script type="text/javascript">
                      $('#time').timepicker();
                  </script>
                  <p>
                    <%= t '.place' %>
                  </p>
                  <%= f.text_field :place, :class => 'form-control', :value => match.place %>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class='btn btn-success btn-xs'>
                      <%= f.submit t('helpers.links.save'), :class => 'btn btn-success btn-sm' %>
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                      <%= t('helpers.links.cancel') %>
                    </button>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </td>
        <td>
          <%= link_to t('.show', default: t('helpers.links.show')),
                      match_path(match), :class => 'btn btn-default btn-xs' %>
          <%= link_to t('.edit', default: t('helpers.links.edit')),
                      edit_match_path(match), :class => 'btn btn-default btn-xs' %>
          <%= link_to t('.destroy', default: t('helpers.links.destroy')),
                      match_path(match),
                      :method => :delete,
                      :data => { :confirm => t('.confirm', default: t('helpers.links.confirm')) },
                      :class => 'btn btn-xs btn-danger' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>